=======
Logging
=======

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

.. _logging:

Overview
--------

.. What is on this page?

In this guide, we show you how to set up and configure a logger in the
MongoDB Java Driver.

.. What do any new terms mean?

.. Not applicable. We are treating definition of logger as understood.

.. What can you expect to see on this page?

In this guide you will learn how to:

- Set up a logger
- Configure your log level

.. Who should read this? Where should I go if this isn't the page I was looking for?

.. Not Applicable. No natural redirect location.

Set Up a Logger
---------------

To set up a logger for your project, you need to add some dependencies.

The MongoDB Java Driver uses the Simple Logging Facade For Java (SLF4J).
SLF4J allows you to specify your logging framework of choice at deployment time.
For more information on SLF4J,
`see the SLF4J documentation <http://www.slf4j.org/>`__.

To set up a logger you must add the ``slf4j-api``, a logging framework, and a
**binding** to your project's dependency list. A binding is a piece of code that
connects the ``slf4j-api`` with a logging framework. The two most
popular logging frameworks used with the ``slf4j-api`` are ``Log4j2`` and ``Logback``.

Below are some examples demonstrating how to add SLF4J dependencies to your
project and set up your logger. 

If you are using Maven, add one of the following to your ``pom.xml`` dependencies list:

.. tabs::

   .. tab:: Logback
      :tabid: logback-binding

      Adding these dependencies will configure the MongoDB Java Driver to output
      your logs using the Logback framework.

      .. code-block:: xml

         <!-- SLF4J API -->
         <dependency>
           <groupId>org.slf4j</groupId>
           <artifactId>slf4j-api</artifactId>
           <version>1.7.30</version>
         </dependency>
         <!-- This package contains an SLF4J-Logback binding -->
         <dependency>
           <groupId>ch.qos.logback</groupId>
           <artifactId>logback-classic</artifactId>
           <version>1.2.3</version>
         </dependency>
         <!-- Logback Core Functionality -->
         <dependency>
           <groupId>ch.qos.logback</groupId>
           <artifactId>logback-core</artifactId>
           <version>1.2.3</version>
         </dependency>


      Once you have installed the above dependencies, try connecting to a
      MongoDB instance and retrieving a document with the following code.

      .. code-block:: java

         MongoClient mongoClient = MongoClients.create(<my uri>);
         MongoDatabase database = mongoClient.getDatabase(<my database>);
         MongoCollection<Document> collection = database.getCollection(<my collection>);
         collection.find().first();

      You should see output resembling the following:

      .. code-block:: none

         ...
         1156 [main] DEBUG o.m.driver.protocol.command - Sending command '{"find": "<your collection>", "filter": {}, "limit": 1, "singleBatch": true, "$db": "<your db>", "lsid": {"id": {"$binary": {"base64": "J1hTWnLrQTe/3LyhQyB/MA==", "subType": "04"}}}}' with request id 13 to database sample_mflix on connection <your connection> to server <your server>
         1173 [main] DEBUG o.m.driver.protocol.command - Execution of command with request id 13 completed successfully in 30.01 ms on connection <your connection> to server <your server>
   
   .. tab:: Log4j2
      :tabid: Log4j2-binding
   
      Adding these dependencies will configure the MongoDB Java Driver to output
      your logs using the Log4j2 framework.

      .. code-block:: xml      
      
         <!-- SLF4J API -->
         <dependency>
           <groupId>org.slf4j</groupId>
           <artifactId>slf4j-api</artifactId>
           <version>1.7.30</version>
         </dependency>
         <!-- SLF4J-Log4j2 binding -->
         <dependency>
           <groupId>org.apache.logging.log4j</groupId>
           <artifactId>log4j-slf4j-impl</artifactId>
           <version>2.14.1</version>
         </dependency>
         <!-- Log4j2 core functionality -->
         <dependency>
           <groupId>org.apache.logging.log4j</groupId>
           <artifactId>log4j-core</artifactId>
           <version>2.14.1</version>
         </dependency>

      Once you have installed the above dependencies, try connecting to a
      MongoDB instance and retrieving a document with the following code.

      .. code-block:: java

         import org.slf4j.Logger;
         import org.slf4j.LoggerFactory;

         ...

         Logger logger = LoggerFactory.getLogger(App.class);
         logger.error("Logging an Error");

      You should see output resembling the following:

      .. code-block:: none

         12:35:00.438 [main] ERROR <my package path> - Logging an Error


Configure your Logger
---------------------

To configure your logger, you will need to configure the logging framework
you specified when you set up your logger.

We will provide an example of how to set your log level with both the ``log4j2``
and the ``logback`` frameworks.

Configure Log level
~~~~~~~~~~~~~~~~~~~

Log levels form a hierarchy of messages output by a logger. Messages related to
errors are the most important, and messages related to
stack traces or debugging are the least important. Logging frameworks have some
variation in the log levels they support. 

Here is an examples demonstrating how to configure your logger's log level for
both the ``logback`` and ``log4j2`` logging frameworks.

.. tabs::

   .. tab:: Logback
      :tabid: logback-binding

      You specify logback configuration in your ''logback.xml'' file. Your
      ''logback.xml'' file must be accessible from your class path. 

      The ``logback`` framework defines the following logging levels. You can
      see the logging levels listed below in order from most important to least
      important: 
      
      - ERROR
      - WARN
      - INFO
      - DEBUG
      - TRACE 

      To configure a Logback logger to log all messages of level INFO or
      higher, set your ``logback.xml`` file to the following.

      .. code-block:: xml

         <configuration>
           <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
             <filter class="ch.qos.logback.classic.filter.LevelFilter">
               <level>INFO</level>
               <onMatch>ACCEPT</onMatch>
               <onMismatch>DENY</onMismatch>
             </filter>
             <encoder>
               <pattern>
                 %-4relative [%thread] %-5level %logger{30} - %msg%n
               </pattern>
             </encoder>
           </appender>
           <root level="DEBUG">
             <appender-ref ref="CONSOLE" />
           </root>
         </configuration>

      This example is based of the
      `Level Filter Example in chapter seven of the Logback Manual <https://logback.qos.ch/manual/filters.html#levelFilter>`__.

      .. tabs::

   .. tab:: Log4j2
      :tabid: log4j2-binding

      You specify log4j2 configuration in your ''log4j2.xml'' file. Your
      ''log4j2.xml'' file must be accessible from your class path. 

      The ``log4j2`` framework defines the following logging levels. You can see the
      logging levels listed below in order from most important to least
      important: 
      
      - OFF
      - FATAL
      - ERROR
      - WARN
      - INFO
      - DEBUG
      - TRACE
      - ALL 

      To configure a log4j2 logger to log all messages of level INFO or
      higher, set your ``log4j2.xml`` file to the following.

      .. code-block:: xml

         <?xml version="1.0" encoding="UTF-8"?>
         <Configuration status="INFO">
            <Appenders>
               <Console name="Console" target="SYSTEM_OUT">
                     <PatternLayout pattern="%d{HH:mm:ss.SSS} [%t] %-5level %logger{36} - %msg%n"/>
               </Console>
            </Appenders>
            <Loggers>
               <Root level="info">
                     <AppenderRef ref="Console"/>
               </Root>
            </Loggers>
         </Configuration>

      For more information on configuring ``log4j2``, see the official 
      `log4j2 configuration guide <https://logging.apache.org/log4j/2.x/manual/configuration.html>`__.